---
- name: Configure system
  hosts: vps
  vars_files:
    - vars/public.yml
    - vars/vault.yml
  roles:
    - role: reverse_proxy
    - role: recipes
    - role: backups
    - role: notifications
    - role: artis3n.tailscale.machine
    - role: ai_client
    - role: firewall
    - role: hifis.toolkit.unattended_upgrades
      become: true
      unattended_mail: root
    - role: geerlingguy.swap
      become: true
  tasks:
    - name: Add podman cleanup job
      become: true
      ansible.builtin.cron:
        name: Cleanup dangling podman extras
        minute: "0"
        hour: "3"
        day: "*"
        month: "*"
        weekday: "0"
        job: podman volume prune -f &> /dev/null && podman image prune -af &> /dev/null
